<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="utf-8">
	<title>&</title>
	<meta name="description" content="">
	<meta name="author" content="David Prager Branner">

	<!-- HTML5 shim, for IE6-8 support of HTML elements -->
	<!--[if lt IE 9]>
		<script src="http://brannerchinese.github.io/website/theme/html5.js"></script>
	<![endif]-->

	<!-- Styles -->
	<link href="http://brannerchinese.github.io/website/theme/bootstrap.min.css" rel="stylesheet">
	<link href="http://brannerchinese.github.io/website/theme/local.css" rel="stylesheet">
	<link href="http://brannerchinese.github.io/website/theme/pygments.css" rel="stylesheet">

    <!-- Feeds -->
    <link href="http://brannerchinese.github.io/website/http://brannerchinese.github.io/website/feeds/all.atom.xml" type="application/atom+xml" rel="alternate" title="& Atom Feed" />

</head>
<body>
	<div class="topbar">
	  <div class="topbar-inner">
		<div class="container-fluid">
		  <a class="brand" href="http://brannerchinese.github.io/website/">&</a>
			<ul class="nav">
					<li class="active"><a href="http://brannerchinese.github.io/website/category/.html"></a></li>
			</ul>
			<p class="pull-right"><a href="http://brannerchinese.github.io/website/archives.html">[archives]</a> <a href="http://brannerchinese.github.io/website/tags.html">[tags]</a></p>
		</div>
	  </div>
	</div>

	<div class="container-fluid">
	  <div class="sidebar">
		<div class="well">
			<h3>Blogroll</h3>
			<ul>
				<li><a href="https://brannerchinese.com/dpb/publications.html">Publications</a></li>
			</ul>
			<div class="social">
			<h3>Social</h3>
			<ul>
				<li><a href="http://brannerchinese.github.io/website/feeds/all.atom.xml">RSS</a></li>
			</ul>
			</div>
		</div>
	  </div>
	  <div class="content">
	<div class='article'>
		<div class="page-header"><h1>A small triumph of explicitly readable code</h1></div>
		<div class="well small">Permalink: <a class="more" href="http://brannerchinese.github.io/website/a-small-triumph-of-explicitly-readable-code.html">2012-12-06 20:44:00</a>
by <a class="url fn" href="http://brannerchinese.github.io/website/author/david-prager-branner.html">David Prager Branner </a>
 in <a href="http://brannerchinese.github.io/website/category/.html"></a>
</div>
		<div><p>Recently I was asked to write an implementation of FizzBuzz*, a new
notion to me. I took, I suppose, a quarter of an hour and put together a
little Python program â€” it worked, and I felt clever because I had found
two little time-saving tactics:</p>
<ol>
<li>taking care of the cases in order of how frequently they crop up
    (unmarked cases account for 8 in every 15; the "Fizz" case is 4 in
    15, "Buzz" is 2 in 15, and the co-occurrence "FizzBuzz" is 1 case in
    15);</li>
<li>taking care of the FizzBuzz case as a subset of the Fizz case.</li>
</ol>
<p>I submitted the code yesterday and went to sleep feeling good. This
morning, however, I started to wonder how many different implementations
there might be, since the basic idea is not terribly complicated.</p>
<p>Well, there are large numbers of implementations, and I was impressed to
see how many crafty one-liners people have come up with. I studied a few
of them and learned a thing or two. Although I classify myself as a fox
on the <a href="http://en.wikipedia.org/wiki/The_Hedgehog_and_the_Fox">Archilochan dichotomy</a>, my mind is slower than other people's,
and it is my weakness as a programmer always to write as simply and
explicitly as I can. When I see craftiness at work, after the initial
envy subsides, I always feel I'll never catch up to it, although I
usually then try to untangle what the experts have created, for my own
education. I timed the various implementations, too, and mine came out
far and away the slowest (results in seconds):</p>
<div class="highlight"><pre><span class="n">iterations</span> <span class="o">=</span>  <span class="mi">100</span>
<span class="o">&lt;</span><span class="n">function</span> <span class="n">dpb</span> <span class="n">at</span> <span class="mh">0x1107791b8</span><span class="o">&gt;</span><span class="p">:</span> <span class="mf">0.00968</span>
<span class="o">&lt;</span><span class="n">function</span> <span class="n">tamurakoichi</span> <span class="n">at</span> <span class="mh">0x110779320</span><span class="o">&gt;</span><span class="p">:</span> <span class="mf">0.00067</span>
<span class="o">&lt;</span><span class="n">function</span> <span class="n">anonymous</span> <span class="n">at</span> <span class="mh">0x110779398</span><span class="o">&gt;</span><span class="p">:</span> <span class="mf">0.00144</span>
<span class="o">&lt;</span><span class="n">function</span> <span class="n">smog</span> <span class="n">at</span> <span class="mh">0x110779410</span><span class="o">&gt;</span><span class="p">:</span> <span class="mf">0.00158</span>
<span class="o">&lt;</span><span class="n">function</span> <span class="n">chrisclark</span> <span class="n">at</span> <span class="mh">0x110779488</span><span class="o">&gt;</span><span class="p">:</span> <span class="mf">0.00181</span>
<span class="o">&lt;</span><span class="n">function</span> <span class="n">jefallbright</span> <span class="n">at</span> <span class="mh">0x110779500</span><span class="o">&gt;</span><span class="p">:</span> <span class="mf">0.00158</span>
<span class="o">&lt;</span><span class="n">function</span> <span class="n">anonymous2</span> <span class="n">at</span> <span class="mh">0x110779578</span><span class="o">&gt;</span><span class="p">:</span> <span class="mf">0.00072</span>
<span class="o">&lt;</span><span class="n">function</span> <span class="n">anonymous4</span> <span class="n">at</span> <span class="mh">0x1107795f0</span><span class="o">&gt;</span><span class="p">:</span> <span class="mf">0.00171</span>
</pre></div>


<p>So much for the advantages of writing clear, explicit code!</p>
<p>But then I looked a little more closely, and saw that most of these
faster methods assembled the whole output as a string or array first,
and then printed it all at once. I had been printing each line at a
time, surely an expensive luxury.</p>
<p>So I rewrote all the implementations to generate an output-string
without sending it to the console.** That allowed me to compare the
results, string to string, and gave me a more equable basis for timing
comparisons. And the results now?</p>
<div class="highlight"><pre><span class="n">iterations</span> <span class="o">=</span>  <span class="mi">100</span>
<span class="o">&lt;</span><span class="n">function</span> <span class="n">dpb</span> <span class="n">at</span> <span class="mh">0x10a729230</span><span class="o">&gt;</span><span class="p">:</span> <span class="mf">0.00018</span>
<span class="o">&lt;</span><span class="n">function</span> <span class="n">tamurakoichi</span> <span class="n">at</span> <span class="mh">0x10a729668</span><span class="o">&gt;</span><span class="p">:</span> <span class="mf">0.00021</span>
<span class="o">&lt;</span><span class="n">function</span> <span class="n">anonymous</span> <span class="n">at</span> <span class="mh">0x10a7291b8</span><span class="o">&gt;</span><span class="p">:</span> <span class="mf">0.00023</span>
<span class="o">&lt;</span><span class="n">function</span> <span class="n">smog</span> <span class="n">at</span> <span class="mh">0x10a7292a8</span><span class="o">&gt;</span><span class="p">:</span> <span class="mf">0.00021</span>
<span class="o">&lt;</span><span class="n">function</span> <span class="n">chrisclark</span> <span class="n">at</span> <span class="mh">0x10a729320</span><span class="o">&gt;</span><span class="p">:</span> <span class="mf">0.00117</span>
<span class="o">&lt;</span><span class="n">function</span> <span class="n">jefallbright</span> <span class="n">at</span> <span class="mh">0x10a729398</span><span class="o">&gt;</span><span class="p">:</span> <span class="mf">0.00100</span>
<span class="o">&lt;</span><span class="n">function</span> <span class="n">anonymous2</span> <span class="n">at</span> <span class="mh">0x10a729410</span><span class="o">&gt;</span><span class="p">:</span> <span class="mf">0.00024</span>
<span class="o">&lt;</span><span class="n">function</span> <span class="n">anonymous4</span> <span class="n">at</span> <span class="mh">0x10a729488</span><span class="o">&gt;</span><span class="p">:</span> <span class="mf">0.00019</span>

<span class="n">iterations</span> <span class="o">=</span> <span class="mi">10000000</span>
<span class="o">&lt;</span><span class="n">function</span> <span class="n">dpb</span> <span class="n">at</span> <span class="mh">0x10a729230</span><span class="o">&gt;</span><span class="p">:</span> <span class="mf">12.48893</span>
<span class="o">&lt;</span><span class="n">function</span> <span class="n">tamurakoichi</span> <span class="n">at</span> <span class="mh">0x10a729668</span><span class="o">&gt;</span><span class="p">:</span> <span class="mf">15.50518</span>
<span class="o">&lt;</span><span class="n">function</span> <span class="n">anonymous</span> <span class="n">at</span> <span class="mh">0x10a7291b8</span><span class="o">&gt;</span><span class="p">:</span> <span class="mf">19.88059</span>
<span class="o">&lt;</span><span class="n">function</span> <span class="n">smog</span> <span class="n">at</span> <span class="mh">0x10a7292a8</span><span class="o">&gt;</span><span class="p">:</span> <span class="mf">72.46663</span>
<span class="o">&lt;</span><span class="n">function</span> <span class="n">chrisclark</span> <span class="n">at</span> <span class="mh">0x10a729320</span><span class="o">&gt;</span><span class="p">:</span> <span class="mf">87.58923</span>
<span class="o">&lt;</span><span class="n">function</span> <span class="n">jefallbright</span> <span class="n">at</span> <span class="mh">0x10a729398</span><span class="o">&gt;</span><span class="p">:</span> <span class="mf">70.65603</span>
<span class="o">&lt;</span><span class="n">function</span> <span class="n">anonymous2</span> <span class="n">at</span> <span class="mh">0x10a729410</span><span class="o">&gt;</span><span class="p">:</span> <span class="mf">17.89535</span>
<span class="o">&lt;</span><span class="n">function</span> <span class="n">anonymous4</span> <span class="n">at</span> <span class="mh">0x10a729488</span><span class="o">&gt;</span><span class="p">:</span> <span class="mf">19.54576</span>
</pre></div>


<p>My painfully explicit code is also the fastest of the implementations
I've examined.</p>
<p>Well, I feel a little better now. Readable code is vindicated!</p>
<hr />
<p>* "Count incrementally, replacing any number divisible by three with
the word 'fizz', and any number divisible by five with the word 'buzz'."
<a href="http://en.wikipedia.org/wiki/FizzBuzz">Wikipedia article "FizzBuzz"</a>, accessed 20121206.</p>
<hr />
<p>** Here is my code, with the algorithm just as submitted but revised
to save the printing time:</p>
<div class="highlight"><pre><span class="k">def</span> <span class="nf">dpb</span><span class="p">(</span><span class="n">limit</span> <span class="o">=</span> <span class="mi">101</span><span class="p">):</span>
    <span class="n">output</span> <span class="o">=</span> <span class="s">&#39;&#39;</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">xrange</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">limit</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">i</span><span class="o">%</span><span class="mi">3</span> <span class="ow">and</span> <span class="n">i</span><span class="o">%</span><span class="mi">5</span><span class="p">:</span>
            \<span class="c"># neither of the special cases</span>
            <span class="n">output</span> <span class="o">+=</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="o">+</span> <span class="s">&#39;</span><span class="se">\\</span><span class="s">n&#39;</span>
        <span class="k">else</span><span class="p">:</span>
            \<span class="c"># the special cases</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">i</span><span class="o">%</span><span class="mi">3</span><span class="p">:</span>
                \<span class="c"># divisible by 3;</span>
                \<span class="c"># we are not done yet so no linebreak</span>
                <span class="n">output</span> <span class="o">+=</span> <span class="s">&#39;Fizz&#39;</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">i</span><span class="o">%</span><span class="mi">5</span><span class="p">:</span>
                \<span class="c"># divisible by 5</span>
                <span class="n">output</span> <span class="o">+=</span> <span class="s">&#39;Buzz</span><span class="se">\\</span><span class="s">n&#39;</span>
            <span class="k">else</span><span class="p">:</span>
                \<span class="c"># now add linebreak after Fizz case</span>
                <span class="n">output</span> <span class="o">+=</span> <span class="s">&#39;</span><span class="se">\\</span><span class="s">n&#39;</span>
    <span class="k">return</span> <span class="n">output</span>
</pre></div>


<p>[end]</p></div>
		<div>
			<h2>Comments</h2>
		<div>
	</div>	
		<footer>
		  <p>Powered by <a href="http://getpelican.com/">Pelican</a>. Theme based on <a href="http://twitter.github.com/bootstrap/">Twitter Bootstrap</a>.</p>
		  <p>&copy; David Prager Branner</p>
		</footer>
	  </div>

	</div>
</body>
</html>