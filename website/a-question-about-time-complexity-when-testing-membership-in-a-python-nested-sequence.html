<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="utf-8">
	<title>&</title>
	<meta name="description" content="">
	<meta name="author" content="David Prager Branner">

	<!-- HTML5 shim, for IE6-8 support of HTML elements -->
	<!--[if lt IE 9]>
		<script src="http://brannerchinese.github.io/website/theme/html5.js"></script>
	<![endif]-->

	<!-- Styles -->
	<link href="http://brannerchinese.github.io/website/theme/bootstrap.min.css" rel="stylesheet">
	<link href="http://brannerchinese.github.io/website/theme/local.css" rel="stylesheet">
	<link href="http://brannerchinese.github.io/website/theme/pygments.css" rel="stylesheet">

    <!-- Feeds -->
    <link href="http://brannerchinese.github.io/website/feeds/all.atom.xml" type="application/atom+xml" rel="alternate" title="& Atom Feed" />

</head>
<body>
	<div class="topbar">
	  <div class="topbar-inner">
		<div class="container-fluid">
		  <a class="brand" href="http://brannerchinese.github.io/website/">&</a>
			<ul class="nav">
					<li class="active"><a href="http://brannerchinese.github.io/website/category/.html"></a></li>
			</ul>
			<p class="pull-right"><a href="http://brannerchinese.github.io/website/archives.html">[archives]</a> <a href="http://brannerchinese.github.io/website/tags.html">[tags]</a></p>
		</div>
	  </div>
	</div>

	<div class="container-fluid">
	  <div class="sidebar">
		<div class="well">
			<h3>Blogroll</h3>
			<ul>
				<li><a href="https://brannerchinese.com/dpb/publications.html">Publications</a></li>
			</ul>
			<div class="social">
			<h3>Social</h3>
			<ul>
				<li><a href="../feeds/all.atom.xml">RSS</a></li>
			</ul>
			</div>
		</div>
	  </div>
	  <div class="content">
	<div class='article'>
		<div class="page-header"><h1>A question about time complexity when testing membership in a Python nested sequence</h1></div>
		<div class="well small">Permalink: <a class="more" href="http://brannerchinese.github.io/website/a-question-about-time-complexity-when-testing-membership-in-a-python-nested-sequence.html">2013-07-22 16:22:00</a>
by <a class="url fn" href="http://brannerchinese.github.io/website/author/brannerchinese.html">brannerchinese </a>
 in <a href="http://brannerchinese.github.io/website/category/.html"></a>
</div>
		<div><p><strong>(Corrected at bottom.)</strong></p>
<p>Python's <code>in</code> operator tests for membership in a sequence.</p>
<div class="highlight"><pre><span class="n">In</span> <span class="p">[</span><span class="mi">1</span><span class="p">]:</span> <span class="n">a</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">]</span>
<span class="n">In</span> <span class="p">[</span><span class="mi">2</span><span class="p">]:</span> <span class="mi">1</span> <span class="ow">in</span> <span class="n">a</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">2</span><span class="p">]:</span> <span class="bp">True</span>
</pre></div>


<p>But it does not work directly on nested sequences such as a list of
lists or two-dimensional matrix:</p>
<div class="highlight"><pre><span class="n">In</span> <span class="p">[</span><span class="mi">3</span><span class="p">]:</span> <span class="n">a</span> <span class="o">=</span> <span class="p">[[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">],</span> <span class="p">[</span><span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">]]</span>
<span class="n">In</span> <span class="p">[</span><span class="mi">4</span><span class="p">]:</span> <span class="mi">1</span> <span class="ow">in</span> <span class="n">a</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">4</span><span class="p">]:</span> <span class="bp">False</span>
</pre></div>


<p>What is the most efficient way to do that?</p>
<hr />
<p>I thought of three approaches:</p>
<ol>
<li>Iteration through the first-level sequences composing the matrix,
    using a list comprehension</li>
<li>Flattening the matrix first</li>
<li>Creating the matrix in flat form to begin with</li>
</ol>
<p>My prediction was that creating the matrix in flat form to begin with
would be the fastest and that flattening the matrix first would be the
slowest. Of course, flattening a matrix is likely to increase the
running time.</p>
<p>I wrote five tests. For matrices with very small dimensions, my
predictions are correct. But as the dimensions become large, iterating
through the first-level sequences turned out to be significantly faster
than all other methods. <strong>[Wrong! There was an error in my code. I've
corrected it after the end of the original post.]</strong> Below I discuss only
the two most interesting ones.</p>
<p><strong>Results</strong></p>
<p>I populated the matrix with random floating point numbers and searched
for an additional random floating point number in it; that should give
worst-case performance since it is unlikely that any 16-digit random
numbers would appear twice in such relatively small samples.</p>
<p>The difference in speed for the plain use of the <code>in</code> operator looks
like it must involve a difference in time complexity, but I that there
is such a difference; I'd be happy to hear from anyone who can explain
this to me.</p>
<ol>
<li>
<p>Creating the matrix in flat form to begin with</p>
<div class="highlight"><pre><span class="n">python</span> <span class="o">-</span><span class="n">m</span> <span class="n">timeit</span> <span class="o">-</span><span class="n">s</span> <span class="err">&#39;\</span>  
<span class="n">from</span> <span class="n">random</span> <span class="n">import</span> <span class="n">random</span><span class="p">;</span><span class="err">\</span>  
<span class="n">i</span> <span class="o">=</span> <span class="n">j</span> <span class="o">=</span> <span class="mi">3</span><span class="p">;</span><span class="err">\</span>  
<span class="n">matrix</span> <span class="o">=</span> <span class="p">[</span><span class="n">random</span><span class="p">()</span> <span class="k">for</span> <span class="n">item</span> <span class="n">in</span> <span class="n">range</span><span class="p">(</span><span class="n">i</span><span class="err">\</span><span class="o">*</span><span class="n">j</span><span class="p">)]</span><span class="sc">&#39; &#39;</span><span class="err">\</span>  
<span class="n">random</span><span class="p">()</span> <span class="n">in</span> <span class="n">matrix</span><span class="err">&#39;</span>
</pre></div>


<p>Results:</p>
<div class="highlight"><pre><span class="c"># i = j = 10000; 10 loops, best of 3: 1.61 sec per loop</span>
<span class="c"># i = j = 1000; 100 loops, best of 3: 15.9 msec per loop</span>
<span class="c"># i = j = 100; 10000 loops, best of 3: 158 usec per loop</span>
<span class="c"># i = j = 10; 1000000 loops, best of 3: 1.63 usec per loop</span>
<span class="c"># i = j = 3; 10000000 loops, best of 3: 0.194 usec per loop</span>
</pre></div>


<p>Comments:</p>
<ul>
<li><code>in</code> list: O(n) (following the <a href="http://wiki.python.org/moin/PythonSpeed/">Python wiki page on time complexity</a>)</li>
<li>total complexity: O(n)</li>
</ul>
<p>The observed speed increase is about a factor of 100 for every factor of 100 increase to <code>n</code> â€” in other words, O(n).</p>
</li>
<li>
<p>With use of <code>in</code> operator and a list comprehension</p>
<div class="highlight"><pre><span class="n">python</span> <span class="o">-</span><span class="n">m</span> <span class="n">timeit</span> <span class="o">-</span><span class="n">s</span> <span class="err">&#39;\</span>  
<span class="n">from</span> <span class="n">random</span> <span class="n">import</span> <span class="n">random</span><span class="p">;</span><span class="err">\</span>  
<span class="n">i</span> <span class="o">=</span> <span class="n">j</span> <span class="o">=</span> <span class="mi">3</span><span class="p">;</span><span class="err">\</span>  
<span class="n">matrix</span> <span class="o">=</span> <span class="p">[[</span><span class="n">random</span><span class="p">()</span> <span class="k">for</span> <span class="n">row</span> <span class="n">in</span> <span class="n">range</span><span class="p">(</span><span class="n">j</span><span class="p">)]</span> <span class="k">for</span> <span class="n">column</span> <span class="n">in</span> <span class="n">range</span><span class="p">(</span><span class="n">i</span><span class="p">)]</span><span class="sc">&#39; &#39;</span><span class="err">\</span>  
<span class="n">random</span><span class="p">()</span> <span class="n">in</span> <span class="p">[</span><span class="n">row</span> <span class="k">for</span> <span class="n">row</span> <span class="n">in</span> <span class="n">matrix</span><span class="p">]</span><span class="err">&#39;</span>
</pre></div>


<p>Results:</p>
<div class="highlight"><pre><span class="err">\#</span> <span class="n">i</span> <span class="o">=</span> <span class="n">j</span> <span class="o">=</span> <span class="mi">10000</span><span class="p">;</span> <span class="mi">1000</span> <span class="n">loops</span><span class="p">,</span> <span class="n">best</span> <span class="n">of</span> <span class="mi">3</span><span class="o">:</span> <span class="mi">516</span> <span class="n">usec</span> <span class="n">per</span> <span class="n">loop</span>
<span class="err">\#</span> <span class="n">i</span> <span class="o">=</span> <span class="n">j</span> <span class="o">=</span> <span class="mi">1000</span><span class="o">:</span> <span class="mi">10000</span> <span class="n">loops</span><span class="p">,</span> <span class="n">best</span> <span class="n">of</span> <span class="mi">3</span><span class="o">:</span> <span class="mf">54.2</span> <span class="n">usec</span> <span class="n">per</span> <span class="n">loop</span>
<span class="err">\#</span> <span class="n">i</span> <span class="o">=</span> <span class="n">j</span> <span class="o">=</span> <span class="mi">100</span><span class="o">:</span> <span class="mi">100000</span> <span class="n">loops</span><span class="p">,</span> <span class="n">best</span> <span class="n">of</span> <span class="mi">3</span><span class="o">:</span> <span class="mf">6.52</span> <span class="n">usec</span> <span class="n">per</span> <span class="n">loop</span>
<span class="err">\#</span> <span class="n">i</span> <span class="o">=</span> <span class="n">j</span> <span class="o">=</span> <span class="mi">10</span><span class="o">:</span> <span class="mi">1000000</span> <span class="n">loops</span><span class="p">,</span> <span class="n">best</span> <span class="n">of</span> <span class="mi">3</span><span class="o">:</span> <span class="mf">1.2</span> <span class="n">usec</span> <span class="n">per</span> <span class="n">loop</span>
<span class="err">\#</span> <span class="n">i</span> <span class="o">=</span> <span class="n">j</span> <span class="o">=</span> <span class="mi">3</span><span class="o">:</span> <span class="mi">1000000</span> <span class="n">loops</span><span class="p">,</span> <span class="n">best</span> <span class="n">of</span> <span class="mi">3</span><span class="o">:</span> <span class="mf">0.457</span> <span class="n">usec</span> <span class="n">per</span> <span class="n">loop</span>
</pre></div>


<p>Comments:</p>
<ul>
<li>one-dimensional list comprehension for square matrix: O(sqrt(n))</li>
<li><code>in</code> list: O(n)</li>
<li>total complexity: O(sqrt(n)) + O(n) âˆˆ O(n)</li>
</ul>
<p>Yet the observed speed increases by about a factor of 10 for every
factor of 100 increase to <code>n</code>. That looks like O(sqrt(n)), rather than
O(n). All I can think is that <code>in</code> must be implicitly optimized for use
with list comprehensions. But a search of documentation turns up nothing
to that effect. (I haven't yet looked at the source code.)</p>
</li>
</ol>
<hr />
<p><strong>Correction (same day)</strong></p>
<p>Darius Bacon wrote: "Your test #2 looks wrong --
<code>random() in [row for row in matrix]</code> will check if <code>random()</code> is equal
to one of the rows in <code>matrix</code>, not if it's equal to an element in any
of the rows."</p>
<p>I checked it more carefully and he's right.</p>
<p>I rewrote it as</p>
<div class="highlight"><pre><span class="n">python</span> <span class="o">-</span><span class="n">m</span> <span class="n">timeit</span> <span class="o">-</span><span class="n">s</span> <span class="err">&#39;\</span>  
<span class="n">from</span> <span class="n">random</span> <span class="n">import</span> <span class="n">random</span><span class="p">;</span><span class="err">\</span>  
<span class="n">i</span> <span class="o">=</span> <span class="n">j</span> <span class="o">=</span> <span class="mi">3</span><span class="p">;</span><span class="err">\</span>  
<span class="n">matrix</span> <span class="o">=</span> <span class="p">[[</span><span class="n">random</span><span class="p">()</span> <span class="k">for</span> <span class="n">row</span> <span class="n">in</span> <span class="n">range</span><span class="p">(</span><span class="n">j</span><span class="p">)]</span> <span class="k">for</span> <span class="n">column</span> <span class="n">in</span> <span class="n">range</span><span class="p">(</span><span class="n">i</span><span class="p">)]</span><span class="sc">&#39; &#39;</span><span class="err">\</span>  
<span class="n">random</span><span class="p">()</span> <span class="n">in</span> <span class="p">[</span><span class="n">item</span> <span class="k">for</span> <span class="n">row</span> <span class="n">in</span> <span class="n">matrix</span> <span class="k">for</span> <span class="n">item</span> <span class="n">in</span> <span class="n">row</span><span class="p">]</span><span class="err">&#39;</span>
</pre></div>


<p>Results:</p>
<div class="highlight"><pre><span class="err">\#</span> <span class="n">i</span> <span class="o">=</span> <span class="n">j</span> <span class="o">=</span> <span class="mi">10000</span><span class="p">;</span> <span class="mi">10</span> <span class="n">loops</span><span class="p">,</span> <span class="n">best</span> <span class="n">of</span> <span class="mi">3</span><span class="o">:</span> <span class="mf">4.3</span> <span class="n">sec</span> <span class="n">per</span> <span class="n">loop</span>
<span class="err">\#</span> <span class="n">i</span> <span class="o">=</span> <span class="n">j</span> <span class="o">=</span> <span class="mi">1000</span><span class="p">;</span> <span class="mi">10</span> <span class="n">loops</span><span class="p">,</span> <span class="n">best</span> <span class="n">of</span> <span class="mi">3</span><span class="o">:</span> <span class="mi">44</span> <span class="n">msec</span> <span class="n">per</span> <span class="n">loop</span>
<span class="err">\#</span> <span class="n">i</span> <span class="o">=</span> <span class="n">j</span> <span class="o">=</span> <span class="mi">100</span><span class="p">;</span> <span class="mi">1000</span> <span class="n">loops</span><span class="p">,</span> <span class="n">best</span> <span class="n">of</span> <span class="mi">3</span><span class="o">:</span> <span class="mi">393</span> <span class="n">usec</span> <span class="n">per</span> <span class="n">loop</span>
<span class="err">\#</span> <span class="n">i</span> <span class="o">=</span> <span class="n">j</span> <span class="o">=</span> <span class="mi">10</span><span class="p">;</span> <span class="mi">100000</span> <span class="n">loops</span><span class="p">,</span> <span class="n">best</span> <span class="n">of</span> <span class="mi">3</span><span class="o">:</span> <span class="mf">5.83</span> <span class="n">usec</span> <span class="n">per</span> <span class="n">loop</span>
<span class="err">\#</span> <span class="n">i</span> <span class="o">=</span> <span class="n">j</span> <span class="o">=</span> <span class="mi">3</span><span class="p">;</span> <span class="mi">1000000</span> <span class="n">loops</span><span class="p">,</span> <span class="n">best</span> <span class="n">of</span> <span class="mi">3</span><span class="o">:</span> <span class="mf">1.1</span> <span class="n">usec</span> <span class="n">per</span> <span class="n">loop</span>
</pre></div>


<p>Now we see the 1:1 proportion between a factor of about 100 for change
in speed corresponding to a factor of 100 for change in <code>n</code>, just as the
order-of-growth equations predict.</p>
<p>And, as originally anticipated, using a linear array is, after all, much
faster than a list of lists.</p>
<p>[end]</p></div>
		<div>
			<h2>Comments</h2>
		<div>
	</div>	
		<footer>
		  <p>Powered by <a href="http://getpelican.com/">Pelican</a>. Theme based on <a href="http://twitter.github.com/bootstrap/">Twitter Bootstrap</a>.</p>
		  <p>&copy; David Prager Branner</p>
		</footer>
	  </div>

	</div>
</body>
</html>